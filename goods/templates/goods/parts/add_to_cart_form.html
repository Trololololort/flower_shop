{% comment %}

Необязательные: addend, button_text

{% include 'goods/parts/add_to_cart_form.html' with goods_id=goods.id referer=request.get_full_path addend=-1 button_text="+" %}

{% endcomment %}



<form id="to-cart-form" class="to-cart-form" method="post" action="{% url 'add-to-cart' %}">
    {% csrf_token %}
    <input type="hidden" name="goods_id" value="{{ goods_id }}">
    <input type="hidden" name="addend" value="{{ addend|default:'1' }}">
    <input type="hidden" name="referer" value="{{ referer }}">
    <button style="min-width: 2.5em;" class="btn btn-primary">{{ button_text|default:"В корзину" }}</button>
</form>


<script>
    $( document ).ready(function() {
        let $toCartForm = $("#to-cart-form");

        function addGoodsToCart(data){

             $.ajax({
                type: "POST",
                url: "{% url 'add-to-cart' %}",
                data: $toCartForm.serialize(),
            });
        }

        function requestDataFromServerWhetherEnoughGoods(){
            $.ajax({
                type: "POST",
                url: "{% url 'are-enough-in-stock' %}",
                data: $toCartForm.serialize(),
                success: addGoodsToCart,
                error: notifyOnShortage
            });

        }


        function addAddToCartFormListener(){
            $toCartForm.on( "submit", function(event) {
                event.preventDefault();
                event.stopPropagation();

                requestDataFromServerWhetherEnoughGoods();
            });
        };


        function notifyOnShortage(data){
            alert("Товар закончился.");
        }

        function addEventListeners(){
            addAddToCartFormListener();
        }

        addEventListeners();
    });
</script>